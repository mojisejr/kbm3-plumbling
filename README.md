# papa_moo_3_bills (kbm3-plumbling)

โปรเจ็กต์นี้เป็นโปรแกรมบรรทัดคำสั่งเขียนด้วยภาษา Rust สำหรับอ่านข้อมูลบิล/ค่าน้ำจากไฟล์ CSV และสร้างใบเสร็จเป็นไฟล์ PDF (รองรับภาษาไทย)

## คุณสมบัติหลัก

- อ่านข้อมูลจากไฟล์ CSV (ตัวอย่างไฟล์อยู่ในโฟลเดอร์ `input-csv/`)
- สร้างไฟล์ PDF ใบเสร็จที่จัดรูปแบบเป็นภาษาไทย
- ใช้ไลบรารี `printpdf` สำหรับการเขียน PDF และ `csv` สำหรับการอ่าน CSV
- โครงสร้างโค้ดแบ่งเป็นโมดูลย่อย เช่น `csv_util`, `pdf_util`, `drawing`, `font_util`, `model`, `log`

## ข้อกำหนดเบื้องต้น

- ติดตั้ง Rust (ชี้แนะใช้ Rustup): https://rustup.rs/
- macOS, Linux หรือ Windows (สามารถคอมไพล์ด้วย Rust ได้)

## วิธีใช้งาน (ตัวอย่าง)

1. โคลน repo:

```bash
git clone https://github.com/mojisejr/kbm3-plumbling.git
cd kbm3-plumbling
```

2. สร้างและรันแบบ Release:

```bash
cargo build --release
cargo run --release
```

หมายเหตุ: ค่าเริ่มต้นใน `src/main.rs` จะอ่านไฟล์ตัวอย่างจาก `input-csv/bills_oct_68.csv` และเขียนผลลัพธ์ไปที่ `bills/plumbing_oct_68.pdf` — ปรับพาธใน `main.rs` หากต้องการไฟล์อื่น

## โครงร่างโปรเจ็กต์

```
./
├── Cargo.toml
├── src/
│   ├── main.rs
│   ├── csv_util.rs
│   ├── pdf_util.rs
│   ├── drawing.rs
│   ├── font_util.rs
│   ├── model.rs
│   └── log.rs
├── input-csv/        # ตัวอย่างไฟล์ CSV
└── bills/            # ที่เก็บไฟล์ PDF ที่สร้างขึ้น
```

## รูปแบบไฟล์ CSV ที่รองรับ (ตัวอย่าง)

โปรแกรมคาดหวังให้ไฟล์ CSV มีคอลัมน์หัวเรื่องเป็นภาษาไทย ดังนี้ (ลำดับคอลัมน์ควรตรงตามตัวอย่าง):

หัวคอลัมน์ (Header):

```
ลำดับ,เลขมิเตอร์,ชื่อ,เลขอ่านครั้งก่อน,เลขอ่านครั้งหลัง,หน่วย,20,หนวยละ,จำนวน
```

ตัวอย่างแถวเดียว (ตัวอย่างค่า):

```
1,123456,นายสมชาย,1200,1250,50,20,2,100
```

คำอธิบายคอลัมน์สั้น ๆ:

- `ลำดับ`: หมายเลขลำดับรายการ (จำนวนเต็ม)
- `เลขมิเตอร์`: หมายเลขมิเตอร์ (ข้อความ)
- `ชื่อ`: ชื่อผู้ใช้น้ำ/ผู้รับบิล (ข้อความ)
- `เลขอ่านครั้งก่อน`: ค่ามิเตอร์ก่อนหน้า (จำนวนเต็ม)
- `เลขอ่านครั้งหลัง`: ค่ามิเตอร์ล่าสุด (จำนวนเต็ม)
- `หน่วย`: ผลต่างหน่วยที่ใช้ (จำนวนเต็ม)
- `20`: ค่าบริการบำรุงรักษา (จำนวนเต็ม) — ชื่อคอลัมน์เป็น `20` ตามที่โปรแกรมคาดหวัง
- `หนวยละ`: อัตราต่อหน่วย (จำนวนเต็ม)
- `จำนวน`: ยอดเงินทั้งหมดสำหรับบิลนี้ (จำนวนเต็ม)

หมายเหตุ: ฟิลด์ชื่อคอลัมน์ต้องตรงกับที่โปรแกรมกำหนด (`serde(rename = "...")`) หากไฟล์ CSV ของคุณมีชื่อคอลัมน์ภาษาอังกฤษหรือรูปแบบต่างกัน ให้แก้ไขหรือแปลงไฟล์ก่อนรันโปรแกรม

## การพัฒนาและทดสอบ

- สร้าง (debug): `cargo build`
- รัน (debug): `cargo run`
- สร้าง (release): `cargo build --release`
- รัน (release): `cargo run --release`
- รันเทสต์ (ถ้ามี): `cargo test`

## การตั้งค่าโลโก้/ฟอนต์ (ถ้ามี)

โปรเจ็กต์นี้มีการจัดการฟอนต์ด้วย `font_util` และอาจอ่านฟอนต์ที่จำเป็นจากโฟลเดอร์ทรัพยากร หากต้องการฟอนต์ไทยเพิ่มเติม ให้วางไฟล์ฟอนต์ไว้ในตำแหน่งที่ `font_util` คาดหวังหรือแก้โค้ดเพื่อโหลดฟอนต์จากพาธใหม่

## ข้อควรระวัง

- ไม่มี secret/key ภายใน repository นี้
- พาธไฟล์ CSV และไฟล์ผลลัพธ์ถูกตั้งค่าใน `src/main.rs` เป็นค่าเริ่มต้น — ให้แก้ไขเมื่อใช้งานจริง

## วิธีร่วมพัฒนา (สำหรับโอเพนซอร์ส)

1. สร้าง issue หรือค้นหา issue ที่มีอยู่
2. สร้างสาขา feature ตามแบบแผน:

```bash
git checkout -b feature/your-change
```

3. ทำการแก้ไขและรันการทดสอบ/คอมไพล์
4. เปิด Pull Request และอธิบายการเปลี่ยนแปลง


## ใบอนุญาต

โปรดระบุใบอนุญาตที่คุณต้องการใช้สำหรับโปรเจ็กต์นี้ เช่น MIT หรือ Apache-2.0 ในไฟล์ `LICENSE`. หากต้องการฉันสามารถช่วยสร้าง `LICENSE` ให้ได้

---

หากต้องการให้ฉันปรับ README ให้ย่อ/ขยาย เป็นภาษาอังกฤษเพิ่มเติม หรือเพิ่มตัวอย่าง CSV/ผลลัพธ์ PDF ตัวอย่าง แจ้งได้เลย